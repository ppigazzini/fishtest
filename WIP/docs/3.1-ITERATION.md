
# Iteration record (Milestone 1 — drop Pyramid runtime/framework dependency) — completed

Date: 2026-01-23

Milestone definition: [3-MILESTONES.md](3-MILESTONES.md)

Goal (Milestone 1): the running server should not need Pyramid to boot, route, render, or authorize.

Status: **completed** (see “Milestone 1 — reached” in [3-MILESTONES.md](3-MILESTONES.md)).

General iteration rules: [3.0-ITERATION-RULES.md](3.0-ITERATION-RULES.md)

## Phases (all completed)

### Phase 1 — Establish a stable ASGI entrypoint

- [x] Single ASGI entrypoint exists at [server/fishtest/app.py](../../server/fishtest/app.py).
- [x] Middleware + routers are mounted explicitly from the glue layer:
  - API: [server/fishtest/glue/api.py](../../server/fishtest/glue/api.py)
  - UI: [server/fishtest/glue/views.py](../../server/fishtest/glue/views.py)

### Phase 2 — Replace Pyramid runtime features with explicit glue

- [x] Error handling + JSON-vs-HTML decisions centralized in [server/fishtest/glue/errors.py](../../server/fishtest/glue/errors.py).
- [x] Middleware ordering and request state are explicit in [server/fishtest/glue/middleware.py](../../server/fishtest/glue/middleware.py).
- [x] UI cookie session + CSRF shims exist without Pyramid:
  - [server/fishtest/glue/cookie_session.py](../../server/fishtest/glue/cookie_session.py)
  - [server/fishtest/glue/csrf.py](../../server/fishtest/glue/csrf.py)
  - [server/fishtest/glue/template_request.py](../../server/fishtest/glue/template_request.py)
  - [server/fishtest/glue/mako.py](../../server/fishtest/glue/mako.py)

### Phase 3 — Keep Pyramid code as spec/reference only

- [x] Pyramid-era spec modules remain in-tree for behavioral reference/tests (not runtime):
  - [server/fishtest/api.py](../../server/fishtest/api.py)
  - [server/fishtest/views.py](../../server/fishtest/views.py)

- [x] Tests avoid adding Pyramid as a runtime dependency by using stubs under [server/tests/pyramid/](../../server/tests/pyramid).

## Outcome

- The server runs on FastAPI/Starlette without Pyramid in the serving path.
- Pyramid-era behavior contracts are preserved via explicit glue modules.
